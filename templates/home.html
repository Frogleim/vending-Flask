<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <style>
    .card-img-top {
        width: 200px;
        height: 200px;
        object-fit: contain; /* or use 'contain' depending on your design preference */
    }

    .row {
        margin-bottom: 20px;
    }

    .close-icon {
        position: fixed;
        top: 10px; /* Adjust the top position as needed */
        right: 10px; /* Adjust the right position as needed */
        font-size: 40px;
        cursor: pointer;
        color: red; /* Adjust the color as needed */
    }
    #overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* Adjust the alpha value for transparency */
        z-index: 9998; /* Set z-index lower than the popup to ensure it's behind it */
    }

    #popup1 {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 800px;
        height: 200px;
        background-color: white;
        z-index: 9999;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    #popup1 button {
        position: absolute;
        bottom: 30px;
        left: 10%;
        transform: translateX(-50%);
        font-size: 16px;
        cursor: pointer;
    }

    #popup1 button:nth-child(2) {
    position: absolute;
    bottom: 30px;
    left: 90%; /* Set to 0 to place it on the right bottom corner */
    font-size: 16px;
    cursor: pointer;
}
</style>
</head>
<body>


<div class="container text-center">
    <div id="productMessage"></div>
    <div class="close-icon" onclick="PopUpHide()">&times;</div>
    {% for product in data.master_system %}
    <table class="table" data-snipe_id="{{ product.snipe_id }}" onclick="checkAndPopUpShow(this)">
                <tbody>
                    <tr>
                        <td>
                            {% if product.goods_image %}
                                <img src="{{ product.goods_image }}" class="card-img-top" alt="...">
                            {% else %}
                                <img src="https://karanzi.websites.co.in/obaju-turquoise/img/product-placeholder.png" class="rounded float-start" alt="..." height="200">
                            {% endif %}
                        </td>
                        {% if product.goods %}
                            <td><strong>{{ product.goods }}</strong>
                                    </td>
                        {% else %}
                            <td><strong>Cell is Empty</strong></td>
                        {% endif %}
                    </tr>
                </tbody>
        </table>
    {% endfor %}

 <div id="overlay"></div>
    <div id="popup1">
    <button class="btn btn-danger" onclick="cancelButtonClick()">Cancel</button>
    <button class="btn btn-success" onclick="finishButtonClick()">Take it</button>
        <strong id="popupMessage"></strong>
</div>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    // ... your existing JavaScript ...

    $(document).ready(function () {
        PopUpHide();
    });

    function finishButtonClick() {
        var user_id = {{ user_id|tojson|safe }};
        var snipe_id = $("#popup1").data("snipe_id");  // Retrieve snipe_id from the data attribute
        console.log(user_id);
        console.log(snipe_id);

        $.ajax({
            type: "POST",
            url: "{{ url_for('takeout_goods') }}",
            data: {
                snipe_id: snipe_id,
                user_id: user_id
            },
            success: function (response) {
                console.log(response); // Log the response from the server
                // Handle the response as needed (e.g., redirect to /takeout)
                window.location.href = "/takeout";
            },
            error: function (error) {
                console.error("Error:", error);
            }
        });

        PopUpHide(); // Close the popup if needed
    }

    function cancelButtonClick() {
        // Handle the logic when the "Cancel" button is clicked
        console.log("Cancel button clicked");
        // You can add your logic here
        PopUpHide(); // Close the popup if needed
    }

    function PopUpShow(snipe_id, message) {
        $("#popupMessage").text(message);
        $("#popup1").data("snipe_id", snipe_id);  // Store snipe_id in the data attribute
        $("#popup1, #overlay").show();
    }

    function PopUpHide() {
        $("#popup1, #overlay").hide();
    }

    function checkAndPopUpShow(cell) {
        var cellText = $(cell).find("td").text().trim();
        var snipe_id = $(cell).data("snipe_id");  // Retrieve snipe_id from the data attribute
        var title = $(cell).find("td strong").text().trim();

        if (cellText == "Cell is Empty" || cellText == "Goods is None") {
            PopUpShow(null, "This cell is empty.");
        } else {
            PopUpShow(snipe_id, "Title: " + title);
        }
    }

</script>
</div>


</body>
</html>